<div class="container text-center header">
  <div class="row">
    <div class="col-xs-8 col-xs-offset-2">
      <div class="page-header">
        <h1 class="color-red" id="storyboard-headtitle"><%= t '.title' %></h1>
      </div>
      <div class="img-fit">
        <%= image_tag current_user.picture(:profile), class:"pic-dashboard" %>
      </div>
      <div id="identity">
        <h3><%= current_user.first_name%>  <%= current_user.last_name%></h3>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-xs-10 col-md-4 col-md-offset-4">
      <% if current_user.teams.size > 1 %>
        <% current_user.teams.each do |team| %>
        <%= link_to team.name, dashboard_path(team.id, current_user.id), class:"btn btn-sm btn-danger" %>
        <% end %>
        <%= link_to "+", new_user_invitation_path, class:"btn btn-lg btn-blue" %>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-3">
      <h2>user list</h2>
      <ul class="list-unstyled">
        <% @members.each do |member| %>
         <li><%= link_to member.first_name, dashboard_path(current_team.id, member.id) %></li>
        <% end %>
      </ul>
    </div>
    <div class="col-xs-8">
      <% if @user.exercises.size > 0 %>
        <div class="storyboard-subtitle">
          <h2><%= t '.header1' %></h2>
        </div>
        <% current_track = nil %>

        <% @user.exercises.each do |exercise| %>
          <% if current_track != exercise.track %>
            <% if exercise.user_team_sessions(@user, @team).size > 0 %>
              <h3><%= exercise.track.title %></h3>
              <%=
                current_track = exercise.track
                nb_exercises = @user.exercises.select{|ex| ex.track_id == exercise.track.id}.size
                nb_total_exercises = exercise.track.exercises.count
                render "progressbar", percentage: nb_exercises.to_f / nb_total_exercises.to_f * 100.0
              %>
            <% end %>
          <% end %>

          <% exercise.user_team_sessions(@user, @team).each do |session| %>
           <ul class="list-unstyled list-inline">
             <li><h4><%= exercise.title %></h4></li>
             <li><p id="version"><%= "Version: #{l session.updated_at, format: :long}" %></p></li>
              <li><%= link_to '<i class="fa fa-facebook-square"></i>'.html_safe, edit_exercise_session_path(exercise, session), class:"btn btn-sm btn-view-session" %></li>
              <li><%= link_to "Delete", exercise_session_path(exercise, session), method: :delete,
                  data: { confirm: "Are you sure?" }, class:"btn btn-sm btn-danger" %></li>
            <% end %>
          </ul>
          <% end %>
        <div class="spacer-2em"></div>
        <div class="col-xs-12">
          <div class="actions">
            <% unless current_track == nil %>
             <%= link_to "Back to exercises", track_path(current_track), class:"btn btn-lg btn-blue" %>
            <% end %>
            <%= link_to "Back to tracks", tracks_path, class:"btn btn-lg btn-blue" %>
          </div>
        </div>
    </div>
    <% end %>
  </div>
</div>
